<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
세미콜론 (;)으로 구분된 덩어리마다 h2에서 실행

[테이블명: board_table]
default가 붙은 필드는 필수로 insert시 필수입력이 아니다.
테이블 명과 필드 이름은 Camel Case가 아닌 언더바(_)로 구분되는 Snake Type이 좋긴하다.

drop table if exists board_table;
create table board_table(
	id bigint primary key auto_increment,
    boardTitle varchar(50),
    boardWriter varchar(20),
    boardPass varchar(20),
    boardContents varchar(500),
    boardHits int default 0,
    createdAt datetime default now(),
    fileAttached int default 0
);

[테이블명: board_file_table]
drop table if exists board_file_table;
create table board_file_table(
    id bigint auto_increment primary key,
    originalFileName varchar(100),
    storedFileName varchar(100),
    boardId bigint,
    constraint fk_board_file foreign key(boardId) references board_table(id) on delete cascade
);

IntelliJ Community 버전에서는 XML 오타를 잡아주지 않는다 but IntelliJ Ultimate 버전에서는 XML에서 오타를 잡아준다.
-->
<mapper namespace="Board">
    <insert id="create" parameterType="board"> <!-- parameterType의 board는 mybatis-config.xml에서 BoardDto를 alias로 board로 지정한 것을 의미 -->
        insert into board_table(boardTitle, boardWriter, boardPass, boardContents) values(#{boardTitle}, #{boardWriter}, #{boardPass}, #{boardContents})
    </insert>

    <select id="list" resultType="board">
        select *
        from board_table
        order by id desc
    </select>

    <select id="findById" resultType="board" parameterType="Long">
        select id, boardTitle, boardWriter, boardContents, boardPass, boardHits, createdAt
        from board_table
        where id = #{id} <!-- #{} 속 들어가는 이름인 id는 public Board findById(Long id) {} 에서 id 파라미터와 이름이 일치해야함 -->
    </select>

    <select id="findByTitle" resultType="Board" parameterType="String">
        select id, boardTitle, boardWriter, boardContents, boardPass, boardHits, createdAt
        from board_table
        where boardTitle = #{boardTitle}
    </select>

<!--
    <select id="list" resultType="board">
        select id, boardTitle, boardWriter, boardHits, date_format(createdAt, "%Y-%m-%d") as createdAt
        from board_table
        order by id desc
    </select>
-->
</mapper>
